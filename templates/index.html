<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>U.P.L.I.N.K.</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
        /* ═══════════════════════════════════════
           TOKENS & RESET
        ═══════════════════════════════════════ */
        :root {
            --red:    #EF4444;
            --orange: #F97316;
            --green:  #22C55E;
            --blue:   #38BDF8;
            --purple: #A78BFA;
            --bg0:    #060A0F;
            --bg1:    #0D1520;
            --bg2:    #142030;
            --bg3:    #1C2D42;
            --line:   rgba(56,189,248,0.12);
            --line2:  rgba(56,189,248,0.22);
            --t0:     #F0F6FF;
            --t1:     #8BA3BF;
            --t2:     #4D6880;
            --mono:   'JetBrains Mono', monospace;
            --sans:   'Syne', sans-serif;
            --r:      12px;
            --r-sm:   8px;

            /* Layout */
            --nav-h:       56px;
            --sidebar-w:   240px;
            --header-h:    60px;
        }

        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--mono);
            background: var(--bg0);
            color: var(--t0);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scanline texture overlay */
        body::before {
            content: '';
            position: fixed; inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.03) 2px,
                rgba(0,0,0,0.03) 4px
            );
            pointer-events: none;
            z-index: 9999;
        }

        /* ═══════════════════════════════════════
           HEADER
        ═══════════════════════════════════════ */
        .header {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: var(--header-h);
            background: rgba(6,10,15,0.95);
            border-bottom: 1px solid var(--line2);
            backdrop-filter: blur(12px);
            z-index: 500;
            display: flex;
            align-items: center;
            padding: 0 1.25rem;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-family: var(--sans);
            font-size: 1.15rem;
            font-weight: 800;
            color: var(--blue);
            letter-spacing: 2px;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .logo svg { width: 22px; height: 22px; }

        .header-divider {
            width: 1px;
            height: 28px;
            background: var(--line2);
            flex-shrink: 0;
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            flex: 1;
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 1px;
            color: var(--green);
            text-transform: uppercase;
        }

        .live-dot {
            width: 7px; height: 7px;
            border-radius: 50%;
            background: var(--green);
            animation: blink 1.4s infinite;
        }

        @keyframes blink {
            0%,100% { opacity:1; } 50% { opacity:0.3; }
        }

        .header-time {
            font-size: 0.75rem;
            color: var(--t1);
            font-weight: 600;
            letter-spacing: 1px;
            margin-left: auto;
        }

        /* Mobile menu button */
        .menu-btn {
            display: none;
            background: none;
            border: 1px solid var(--line2);
            border-radius: var(--r-sm);
            padding: 0.4rem;
            color: var(--t1);
            cursor: pointer;
            flex-shrink: 0;
            margin-left: auto;
        }

        .menu-btn svg { width: 18px; height: 18px; display: block; }

        /* ═══════════════════════════════════════
           LAYOUT: SIDEBAR + MAIN
        ═══════════════════════════════════════ */
        .shell {
            display: flex;
            padding-top: var(--header-h);
            min-height: 100vh;
        }

        /* ── Sidebar ── */
        .sidebar {
            position: fixed;
            top: var(--header-h);
            left: 0;
            bottom: 0;
            width: var(--sidebar-w);
            background: var(--bg1);
            border-right: 1px solid var(--line);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 400;
            transition: transform 0.3s ease;
        }

        .sidebar-section {
            padding: 1rem 0.75rem 0.5rem;
        }

        .sidebar-label {
            font-size: 0.6rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--t2);
            text-transform: uppercase;
            padding: 0 0.5rem;
            margin-bottom: 0.4rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.65rem;
            padding: 0.65rem 0.75rem;
            border-radius: var(--r-sm);
            border: none;
            background: none;
            color: var(--t1);
            font-family: var(--mono);
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: all 0.15s ease;
            white-space: nowrap;
        }

        .nav-item svg { width: 15px; height: 15px; flex-shrink: 0; }

        .nav-item:hover {
            background: var(--bg3);
            color: var(--t0);
        }

        .nav-item.active {
            background: rgba(56,189,248,0.12);
            color: var(--blue);
            border: 1px solid rgba(56,189,248,0.2);
        }

        .nav-item .badge {
            margin-left: auto;
            background: var(--red);
            color: white;
            font-size: 0.6rem;
            padding: 0.1rem 0.4rem;
            border-radius: 20px;
            font-weight: 700;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 1rem 0.75rem;
            border-top: 1px solid var(--line);
        }

        .sys-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            font-size: 0.68rem;
        }

        .sys-stat-label { color: var(--t2); }
        .sys-stat-val   { color: var(--green); font-weight: 600; }

        /* Sidebar overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 399;
        }

        /* ── Main Content ── */
        .main {
            margin-left: var(--sidebar-w);
            flex: 1;
            padding: 1.5rem;
            min-width: 0;
        }

        /* ═══════════════════════════════════════
           VIEWS
        ═══════════════════════════════════════ */
        .view { display: none; }
        .view.active { display: block; }

        @keyframes fadeIn {
            from { opacity:0; transform:translateY(8px); }
            to   { opacity:1; transform:translateY(0); }
        }

        .view.active { animation: fadeIn 0.25s ease; }

        /* ═══════════════════════════════════════
           GRID SYSTEM
        ═══════════════════════════════════════ */
        .grid {
            display: grid;
            gap: 1rem;
        }

        .grid-12 { grid-template-columns: repeat(12, 1fr); }

        .g-12 { grid-column: span 12; }
        .g-8  { grid-column: span 8; }
        .g-6  { grid-column: span 6; }
        .g-4  { grid-column: span 4; }
        .g-3  { grid-column: span 3; }

        /* ═══════════════════════════════════════
           CARDS
        ═══════════════════════════════════════ */
        .card {
            background: var(--bg1);
            border: 1px solid var(--line);
            border-radius: var(--r);
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: border-color 0.2s;
        }

        .card:hover { border-color: var(--line2); }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-family: var(--sans);
            font-size: 0.85rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
            color: var(--t0);
        }

        .card-title svg { width: 15px; height: 15px; color: var(--blue); flex-shrink: 0; }

        /* Accent top line */
        .card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--blue), var(--purple));
            opacity: 0;
            transition: opacity 0.2s;
        }
        .card:hover::before { opacity: 1; }

        /* Card variants */
        .card-alert {
            background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(185,28,28,0.1));
            border-color: rgba(239,68,68,0.35);
            animation: alert-pulse 3s infinite;
        }

        @keyframes alert-pulse {
            0%,100% { border-color: rgba(239,68,68,0.35); box-shadow: 0 0 0 0 rgba(239,68,68,0); }
            50%      { border-color: rgba(239,68,68,0.6);  box-shadow: 0 0 20px rgba(239,68,68,0.15); }
        }

        /* ═══════════════════════════════════════
           ALERT CARD
        ═══════════════════════════════════════ */
        .alert-title {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-family: var(--sans);
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--red);
            letter-spacing: 1px;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
        }

        .alert-title svg { width: 16px; height: 16px; }

        .action-row {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(0,0,0,0.25);
            border-radius: var(--r-sm);
            border-left: 3px solid rgba(239,68,68,0.5);
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            line-height: 1.5;
            color: var(--t0);
        }

        .action-row svg { width: 14px; height: 14px; flex-shrink: 0; margin-top: 2px; color: var(--red); }
        .action-row strong { color: var(--red); }

        /* ═══════════════════════════════════════
           MAP
        ═══════════════════════════════════════ */
        .map-wrap {
            height: 380px;
            background: linear-gradient(135deg, #0a1520, #0d1e30);
            border-radius: var(--r-sm);
            border: 1px solid var(--line);
            position: relative;
            overflow: hidden;
        }

        /* Grid lines */
        .map-wrap::before {
            content: '';
            position: absolute; inset: 0;
            background-image:
                linear-gradient(rgba(56,189,248,0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(56,189,248,0.04) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Radar sweep */
        .map-wrap::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 300px; height: 300px;
            margin: -150px 0 0 -150px;
            border-radius: 50%;
            background: conic-gradient(
                rgba(56,189,248,0.15) 0deg,
                transparent 60deg,
                transparent 360deg
            );
            animation: radar-sweep 4s linear infinite;
        }

        @keyframes radar-sweep {
            from { transform: rotate(0deg); }
            to   { transform: rotate(360deg); }
        }

        .map-tag {
            position: absolute;
            top: 0.75rem; left: 0.75rem;
            font-size: 0.6rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--blue);
            text-transform: uppercase;
            z-index: 5;
        }

        .risk-zone {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
            border: 2px solid rgba(255,255,255,0.4);
            z-index: 10;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .risk-zone:hover { transform: scale(1.15); }

        .risk-zone.high {
            width: 90px; height: 90px;
            background: radial-gradient(circle, rgba(239,68,68,0.8), rgba(185,28,28,0.6));
            top: 35%; left: 40%;
            box-shadow: 0 0 30px rgba(239,68,68,0.5);
            animation: zone-pulse 2s infinite;
        }

        .risk-zone.medium {
            width: 72px; height: 72px;
            background: radial-gradient(circle, rgba(249,115,22,0.8), rgba(194,65,12,0.6));
            top: 18%; right: 28%;
            box-shadow: 0 0 20px rgba(249,115,22,0.4);
        }

        .risk-zone.low {
            width: 56px; height: 56px;
            background: radial-gradient(circle, rgba(34,197,94,0.8), rgba(21,128,61,0.6));
            bottom: 22%; left: 22%;
            box-shadow: 0 0 15px rgba(34,197,94,0.3);
        }

        @keyframes zone-pulse {
            0%,100% { box-shadow: 0 0 20px rgba(239,68,68,0.4); }
            50%      { box-shadow: 0 0 40px rgba(239,68,68,0.7); }
        }

        /* ═══════════════════════════════════════
           EVIDENCE / SIDEBAR PANEL
        ═══════════════════════════════════════ */
        .evidence-box {
            background: rgba(56,189,248,0.04);
            border: 1px solid rgba(56,189,248,0.15);
            border-radius: var(--r-sm);
            padding: 0.85rem;
            font-size: 0.72rem;
            line-height: 1.6;
            color: var(--t1);
            min-height: 100px;
        }

        .evidence-box h4 {
            font-family: var(--sans);
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--t0);
        }

        .risk-tag {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .risk-tag.high   { background: rgba(239,68,68,0.2);  color: var(--red);    border: 1px solid rgba(239,68,68,0.4); }
        .risk-tag.medium { background: rgba(249,115,22,0.2); color: var(--orange); border: 1px solid rgba(249,115,22,0.4); }
        .risk-tag.low    { background: rgba(34,197,94,0.2);  color: var(--green);  border: 1px solid rgba(34,197,94,0.4); }

        .trigger-list {
            margin-top: 0.5rem;
            padding-left: 0;
            list-style: none;
        }

        .trigger-list li::before { content: '▸ '; color: var(--blue); }
        .trigger-list li { margin-bottom: 0.2rem; }

        /* ═══════════════════════════════════════
           STATUS PILLS
        ═══════════════════════════════════════ */
        .pill-group { display: flex; flex-wrap: wrap; gap: 0.4rem; }

        .pill {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            background: var(--bg2);
            border: 1px solid var(--line);
            font-size: 0.68rem;
            font-weight: 600;
            color: var(--t1);
            white-space: nowrap;
        }

        .pill-dot {
            width: 6px; height: 6px;
            border-radius: 50%;
            background: var(--green);
            animation: blink 1.4s infinite;
        }

        /* ═══════════════════════════════════════
           TELEMETRY NUMBERS
        ═══════════════════════════════════════ */
        .big-number {
            font-size: clamp(1.8rem, 4vw, 2.6rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--blue), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            text-align: center;
            margin: 0.75rem 0 0.25rem;
        }

        .big-label {
            text-align: center;
            font-size: 0.65rem;
            color: var(--t2);
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--line);
            font-size: 0.72rem;
        }

        .stat-row:last-child { border-bottom: none; }
        .stat-row .lbl { color: var(--t2); }
        .stat-row .val { font-weight: 700; color: var(--t0); }
        .stat-row .val.green  { color: var(--green); }
        .stat-row .val.blue   { color: var(--blue); }
        .stat-row .val.orange { color: var(--orange); }

        /* ═══════════════════════════════════════
           CHART
        ═══════════════════════════════════════ */
        .chart-wrap {
            height: 280px;
            position: relative;
        }

        /* ═══════════════════════════════════════
           NETWORK CARDS
        ═══════════════════════════════════════ */
        .net-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.85rem 1rem;
            background: var(--bg2);
            border-radius: var(--r-sm);
            border: 1px solid var(--line);
            margin-bottom: 0.6rem;
            transition: border-color 0.2s;
        }

        .net-row:hover { border-color: var(--line2); }

        .net-icon {
            width: 36px; height: 36px;
            border-radius: 8px;
            background: rgba(56,189,248,0.1);
            border: 1px solid rgba(56,189,248,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--blue);
        }

        .net-icon svg { width: 16px; height: 16px; }

        .net-info { flex: 1; min-width: 0; }
        .net-info h4 { font-family: var(--sans); font-size: 0.8rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .net-info p  { font-size: 0.65rem; color: var(--t2); margin-top: 0.15rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .net-badge {
            flex-shrink: 0;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.62rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .net-badge.online  { background: rgba(34,197,94,0.15);  color: var(--green);  border: 1px solid rgba(34,197,94,0.3); }
        .net-badge.warning { background: rgba(249,115,22,0.15); color: var(--orange); border: 1px solid rgba(249,115,22,0.3); }
        .net-badge.offline { background: rgba(239,68,68,0.15);  color: var(--red);    border: 1px solid rgba(239,68,68,0.3); }

        /* ═══════════════════════════════════════
           ANALYTICS
        ═══════════════════════════════════════ */
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* ═══════════════════════════════════════
           PAGE TITLES
        ═══════════════════════════════════════ */
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .page-title {
            font-family: var(--sans);
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-weight: 800;
            color: var(--t0);
            letter-spacing: 0.5px;
        }

        .page-subtitle {
            font-size: 0.7rem;
            color: var(--t2);
            margin-top: 0.15rem;
        }

        /* ═══════════════════════════════════════
           RISK SUMMARY PILLS (top of risk view)
        ═══════════════════════════════════════ */
        .risk-summary {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .risk-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.6rem 1rem;
            border-radius: var(--r-sm);
            background: var(--bg2);
            border: 1px solid var(--line);
            min-width: 80px;
            flex: 1;
        }

        .risk-chip .num {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1;
        }

        .risk-chip .lbl { font-size: 0.6rem; color: var(--t2); margin-top: 0.2rem; letter-spacing: 1px; text-transform: uppercase; }
        .risk-chip.high   .num { color: var(--red); }
        .risk-chip.medium .num { color: var(--orange); }
        .risk-chip.low    .num { color: var(--green); }

        /* ═══════════════════════════════════════
           RESPONSIVE BREAKPOINTS
        ═══════════════════════════════════════ */

        /* ── Tablet: ≤ 1024px ── */
        @media (max-width: 1024px) {
            :root { --sidebar-w: 200px; }

            .g-8  { grid-column: span 12; }
            .g-4  { grid-column: span 12; }
            .g-3  { grid-column: span 6; }

            .analytics-grid { grid-template-columns: 1fr; }
        }

        /* ── Mobile: ≤ 768px ── */
        @media (max-width: 768px) {
            :root { --header-h: 52px; }

            /* Sidebar becomes a slide-in drawer */
            .sidebar {
                transform: translateX(-100%);
                width: 260px;
                box-shadow: 4px 0 20px rgba(0,0,0,0.5);
            }

            .sidebar.open { transform: translateX(0); }

            .sidebar-overlay.open { display: block; }

            /* Main goes full width */
            .main {
                margin-left: 0;
                padding: 1rem;
            }

            .menu-btn { display: flex; align-items: center; justify-content: center; }

            /* Hide desktop status in header on small screens */
            .header-status .live-badge { display: none; }

            /* All grid columns become full width */
            .g-12, .g-8, .g-6, .g-4, .g-3 { grid-column: span 12; }

            /* Map shorter on mobile */
            .map-wrap { height: 260px; }

            /* Risk zones scale */
            .risk-zone.high   { width: 70px; height: 70px; }
            .risk-zone.medium { width: 56px; height: 56px; }
            .risk-zone.low    { width: 44px; height: 44px; font-size: 0.6rem; }

            .analytics-grid { grid-template-columns: 1fr; }

            .net-info p { display: none; }

            .chart-wrap { height: 220px; }
        }

        /* ── Small Mobile: ≤ 480px ── */
        @media (max-width: 480px) {
            .main { padding: 0.75rem; }
            .card { padding: 1rem; }
            .risk-summary { gap: 0.5rem; }
            .risk-chip { padding: 0.5rem 0.6rem; min-width: 60px; }
            .risk-chip .num { font-size: 1.1rem; }
        }

        /* ── Large Desktop: ≥ 1400px ── */
        @media (min-width: 1400px) {
            .g-3 { grid-column: span 3; }
            .g-4 { grid-column: span 4; }
            .g-6 { grid-column: span 6; }
            .g-8 { grid-column: span 8; }
        }

        /* Skeleton loader */
        .skel {
            background: linear-gradient(90deg, var(--bg2) 25%, var(--bg3) 50%, var(--bg2) 75%);
            background-size: 200% 100%;
            animation: skel-anim 1.5s infinite;
            border-radius: var(--r-sm);
        }

        @keyframes skel-anim {
            0%   { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>

<!-- ══════════════════════════════════
     HEADER
══════════════════════════════════ -->
<header class="header">
    <div class="logo">
        <i data-lucide="satellite"></i>
        U.P.L.I.N.K.
    </div>
    <div class="header-divider"></div>
    <div class="header-status">
        <div class="live-badge">
            <div class="live-dot"></div>
            System Online
        </div>
    </div>
    <div class="header-time" id="live-timestamp">--:--:--</div>
    <button class="menu-btn" id="menu-btn" aria-label="Open menu">
        <i data-lucide="menu"></i>
    </button>
</header>

<!-- Sidebar overlay (mobile) -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<!-- ══════════════════════════════════
     SHELL
══════════════════════════════════ -->
<div class="shell">

    <!-- ── SIDEBAR ── -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-label">Navigation</div>
            <button class="nav-item active" onclick="switchTab('risk-view', this)">
                <i data-lucide="shield-alert"></i> Risk Management
                <span class="badge">!</span>
            </button>
            <button class="nav-item" onclick="switchTab('telemetry-view', this)">
                <i data-lucide="activity"></i> Field Telemetry
            </button>
            <button class="nav-item" onclick="switchTab('network-view', this)">
                <i data-lucide="network"></i> Network Status
            </button>
            <button class="nav-item" onclick="switchTab('analytics-view', this)">
                <i data-lucide="bar-chart-3"></i> Analytics
            </button>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-label">Channels</div>
            <button class="nav-item">
                <i data-lucide="message-square"></i> SMS Gateway
            </button>
            <button class="nav-item">
                <i data-lucide="radio"></i> Radio Broadcast
            </button>
        </div>

        <div class="sidebar-footer">
            <div class="sys-stat">
                <span class="sys-stat-label">LoRa Nodes</span>
                <span class="sys-stat-val">12 / 12</span>
            </div>
            <div class="sys-stat">
                <span class="sys-stat-label">SMS Sent</span>
                <span class="sys-stat-val">47</span>
            </div>
            <div class="sys-stat">
                <span class="sys-stat-label">Uptime</span>
                <span class="sys-stat-val" id="uptime">00:00:00</span>
            </div>
        </div>
    </aside>

    <!-- ── MAIN ── -->
    <main class="main">

        <!-- ════════════════════════════
             RISK MANAGEMENT VIEW
        ════════════════════════════ -->
        <div id="risk-view" class="view active">
            <div class="page-header">
                <div>
                    <div class="page-title">Risk Management</div>
                    <div class="page-subtitle">Environmental risk zones · updated every 15 min</div>
                </div>
            </div>

            <!-- Risk summary chips -->
            <div class="risk-summary">
                <div class="risk-chip high">
                    <div class="num">1</div>
                    <div class="lbl">Critical</div>
                </div>
                <div class="risk-chip medium">
                    <div class="num">1</div>
                    <div class="lbl">Medium</div>
                </div>
                <div class="risk-chip low">
                    <div class="num">1</div>
                    <div class="lbl">Low Risk</div>
                </div>
            </div>

            <!-- Critical Alert -->
            <div class="card card-alert" style="margin-bottom:1rem;">
                <div class="alert-title">
                    <i data-lucide="alert-triangle"></i>
                    Critical Actions Required
                </div>
                <div class="action-row">
                    <i data-lucide="alert-circle"></i>
                    <div><strong>HIGH PRIORITY:</strong> Deploy emergency response teams to Zone 01 — Leptospirosis outbreak risk detected</div>
                </div>
                <div class="action-row">
                    <i data-lucide="radio"></i>
                    <div><strong>COMMUNICATION:</strong> Broadcast health advisory on Radio Channel 7 (AM 702 kHz)</div>
                </div>
                <div class="action-row">
                    <i data-lucide="users"></i>
                    <div><strong>COORDINATION:</strong> Alert barangay health workers for immediate surveillance deployment</div>
                </div>
            </div>

            <!-- Map + Evidence -->
            <div class="grid grid-12">
                <!-- Map -->
                <div class="card g-8">
                    <div class="card-title">
                        <i data-lucide="map"></i>
                        Live Environmental Risk Assessment
                    </div>
                    <div class="map-wrap">
                        <div class="map-tag">⬤ LIVE · RISK ZONE MAP</div>
                        <div class="risk-zone high"   onclick="selectZone('Z01')" title="Zone 01: Critical">Z01</div>
                        <div class="risk-zone medium" onclick="selectZone('Z02')" title="Zone 02: Medium">Z02</div>
                        <div class="risk-zone low"    onclick="selectZone('Z03')" title="Zone 03: Low">Z03</div>
                    </div>
                </div>

                <!-- Evidence + Comms -->
                <div class="g-4" style="display:flex;flex-direction:column;gap:1rem;">
                    <div class="card" style="flex:1;">
                        <div class="card-title">
                            <i data-lucide="microscope"></i>
                            Scientific Evidence
                        </div>
                        <div class="evidence-box" id="evidence-display">
                            <p>Select a risk zone on the map to view peer-reviewed analysis and recommended interventions.</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <i data-lucide="broadcast"></i>
                            Communication Status
                        </div>
                        <div class="pill-group">
                            <div class="pill"><div class="pill-dot"></div> SMS: ACTIVE</div>
                            <div class="pill"><div class="pill-dot"></div> Radio CH-7</div>
                            <div class="pill"><div class="pill-dot"></div> LoRa: 12 nodes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ════════════════════════════
             FIELD TELEMETRY VIEW
        ════════════════════════════ -->
        <div id="telemetry-view" class="view">
            <div class="page-header">
                <div>
                    <div class="page-title">Field Telemetry</div>
                    <div class="page-subtitle">FSU-001 · Live sensor readings</div>
                </div>
            </div>

            <div class="grid grid-12">
                <!-- FSU Status -->
                <div class="card g-3">
                    <div class="card-title">
                        <i data-lucide="cpu"></i> FSU-001
                    </div>
                    <div style="text-align:center;padding:0.75rem 0;">
                        <i data-lucide="box" style="width:48px;height:48px;color:var(--blue);"></i>
                    </div>
                    <div class="big-number" id="battery-level">—</div>
                    <div class="big-label">Battery</div>
                    <div class="stat-row">
                        <span class="lbl">GPS Accuracy</span>
                        <span class="val green" id="gps-accuracy">—</span>
                    </div>
                    <div class="stat-row">
                        <span class="lbl">Satellites</span>
                        <span class="val" id="satellites">—</span>
                    </div>
                    <div class="stat-row">
                        <span class="lbl">LoRa RSSI</span>
                        <span class="val blue" id="lora-rssi">—</span>
                    </div>
                    <div class="stat-row">
                        <span class="lbl">Risk Level</span>
                        <span class="val" id="risk-level-badge">—</span>
                    </div>
                </div>

                <!-- Chart -->
                <div class="card g-6">
                    <div class="card-title">
                        <i data-lucide="activity"></i>
                        Water Quality Telemetry
                    </div>
                    <div class="chart-wrap">
                        <canvas id="telemetryChart"></canvas>
                    </div>
                </div>

                <!-- Current Readings -->
                <div class="card g-3">
                    <div class="card-title">
                        <i data-lucide="thermometer"></i> Readings
                    </div>
                    <div class="big-number" id="turbidity-value">—</div>
                    <div class="big-label">Turbidity (NTU)</div>

                    <div class="big-number" id="conductivity-value">—</div>
                    <div class="big-label">Conductivity (μS/cm)</div>

                    <div class="big-number" id="temperature-value" style="background:linear-gradient(135deg,var(--green),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">—</div>
                    <div class="big-label">Temperature (°C)</div>

                    <div class="big-number" id="humidity-value" style="font-size:1.6rem;">—</div>
                    <div class="big-label">Humidity (%RH)</div>
                </div>
            </div>
        </div>

        <!-- ════════════════════════════
             NETWORK STATUS VIEW
        ════════════════════════════ -->
        <div id="network-view" class="view">
            <div class="page-header">
                <div>
                    <div class="page-title">Network Status</div>
                    <div class="page-subtitle">Resilient multi-channel communication infrastructure</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i data-lucide="network"></i>
                    Communication Channels
                </div>
                <div id="network-list">
                    <div class="skel" style="height:64px;margin-bottom:.6rem;"></div>
                    <div class="skel" style="height:64px;margin-bottom:.6rem;"></div>
                    <div class="skel" style="height:64px;margin-bottom:.6rem;"></div>
                    <div class="skel" style="height:64px;"></div>
                </div>
            </div>
        </div>

        <!-- ════════════════════════════
             ANALYTICS VIEW
        ════════════════════════════ -->
        <div id="analytics-view" class="view">
            <div class="page-header">
                <div>
                    <div class="page-title">Analytics</div>
                    <div class="page-subtitle">Weekly risk trends and alert distribution</div>
                </div>
            </div>

            <div class="analytics-grid">
                <div class="card">
                    <div class="card-title">
                        <i data-lucide="trending-up"></i> Risk Trend
                    </div>
                    <div class="chart-wrap">
                        <canvas id="riskTrendChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i data-lucide="pie-chart"></i> Alert Distribution
                    </div>
                    <div class="chart-wrap">
                        <canvas id="alertDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </main>
</div><!-- end shell -->


<script>
// ══════════════════════════════════════════════
//  INIT
// ══════════════════════════════════════════════

// ── Timestamp & Uptime ─────────────────────
const startTime = Date.now();

function pad(n) { return String(n).padStart(2, '0'); }

function tick() {
    const now = new Date();
    document.getElementById('live-timestamp').textContent =
        `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;

    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const h = Math.floor(elapsed / 3600);
    const m = Math.floor((elapsed % 3600) / 60);
    const s = elapsed % 60;
    document.getElementById('uptime').textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
}
setInterval(tick, 1000);
tick();


// ── Mobile Sidebar ─────────────────────────
const sidebar  = document.getElementById('sidebar');
const overlay  = document.getElementById('sidebar-overlay');
const menuBtn  = document.getElementById('menu-btn');

menuBtn.addEventListener('click', () => {
    sidebar.classList.toggle('open');
    overlay.classList.toggle('open');
});

overlay.addEventListener('click', () => {
    sidebar.classList.remove('open');
    overlay.classList.remove('open');
});


// ── Tab Switching ──────────────────────────
function switchTab(viewId, btn) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
    document.getElementById(viewId).classList.add('active');
    btn.classList.add('active');

    // Close sidebar on mobile after selecting
    if (window.innerWidth <= 768) {
        sidebar.classList.remove('open');
        overlay.classList.remove('open');
    }

    if (viewId === 'network-view')   loadNetworkStatus();
    if (viewId === 'analytics-view') setTimeout(initAnalyticsCharts, 80);
}


// ── Risk Zones ─────────────────────────────

// Demo data loaded immediately so clicking always works
// even before Flask is running
const DEMO_ZONES = [
    {
        id: 'Z01', level: 'high', disease: 'Leptospirosis',
        triggers: ['TDS >680 μS/cm (Threshold: 500)', 'Flood exposure >72 hours', 'Temperature optimal for bacterial growth'],
        reference: 'WHO Guidelines for Drinking Water Quality, 4th Edition (2022)'
    },
    {
        id: 'Z02', level: 'medium', disease: 'Cholera',
        triggers: ['Moderate turbidity levels detected', 'Recent precipitation events', 'Population density: Medium'],
        reference: 'CDC Cholera Surveillance Guidelines (2023)'
    },
    {
        id: 'Z03', level: 'low', disease: 'None',
        triggers: ['Water quality within WHO standards', 'No flood conditions present', 'Population health indicators stable'],
        reference: 'Routine monitoring — no intervention required'
    }
];

let riskZonesCache = DEMO_ZONES; // Start with demo data right away

async function loadRiskZones() {
    try {
        const res = await fetch('/api/risk-zones');
        if (res.ok) {
            riskZonesCache = await res.json();
        }
    } catch(e) {
        // Flask not running — demo data already loaded above, no problem
        console.info('Using demo zone data (Flask not connected).');
    }
    // Always select Z01 on load
    selectZone('Z01');
}

function selectZone(zoneId) {
    const zone = riskZonesCache.find(z => z.id === zoneId);
    if (!zone) return;

    // Highlight the clicked zone on the map
    document.querySelectorAll('.risk-zone').forEach(el => {
        el.style.outline = 'none';
    });
    const zoneEl = document.querySelector(`.risk-zone.${zone.level}`);
    if (zoneEl) zoneEl.style.outline = '3px solid white';

    const triggerHTML = zone.triggers.map(t => `<li>${t}</li>`).join('');

    document.getElementById('evidence-display').innerHTML = `
        <h4>${zone.id} — ${zone.disease}</h4>
        <span class="risk-tag ${zone.level}">${zone.level.toUpperCase()} RISK</span>
        <ul class="trigger-list">${triggerHTML}</ul>
        <div style="margin-top:.6rem;font-size:.65rem;color:var(--t2);">
            <em>Ref: ${zone.reference}</em>
        </div>
    `;
}


// ── Telemetry ──────────────────────────────
let telemetryChart = null;

async function fetchTelemetry() {
    try {
        const res  = await fetch('/api/telemetry');
        const data = await res.json();

        setText('turbidity-value',   data.turbidity);
        setText('conductivity-value', data.conductivity);
        setText('temperature-value',  data.temperature);
        setText('humidity-value',     (data.humidity ?? '—') + (data.humidity ? '%' : ''));
        setText('battery-level',      data.battery + '%');
        setText('gps-accuracy',       '±' + data.gps_accuracy + 'm');
        setText('satellites',         data.satellites + '/16');
        setText('lora-rssi',          data.lora_rssi + ' dBm');

        // Risk badge colour
        const rb = document.getElementById('risk-level-badge');
        if (rb) {
            rb.textContent = data.risk_level || '—';
            rb.style.color = { HIGH: 'var(--red)', MEDIUM: 'var(--orange)', LOW: 'var(--green)' }[data.risk_level] || 'var(--t1)';
        }

        // Push to chart
        if (telemetryChart) {
            const label = new Date().toLocaleTimeString('en-US', { hour12:false, hour:'2-digit', minute:'2-digit' });
            telemetryChart.data.labels.push(label);
            telemetryChart.data.datasets[0].data.push(data.turbidity);
            telemetryChart.data.datasets[1].data.push(data.conductivity);
            if (telemetryChart.data.labels.length > 10) {
                telemetryChart.data.labels.shift();
                telemetryChart.data.datasets.forEach(d => d.data.shift());
            }
            telemetryChart.update('none');
        }
    } catch(e) {
        console.warn('Telemetry unavailable, using demo values.');
    }
}

function setText(id, val) {
    const el = document.getElementById(id);
    if (el) el.textContent = val ?? '—';
}

async function initTelemetryChart() {
    let history = { labels:[], turbidity:[], conductivity:[] };
    try {
        const res = await fetch('/api/telemetry/history');
        history = await res.json();
    } catch(e) {
        // Demo fallback
        history = {
            labels:       ['10:00','11:00','12:00','13:00','14:00','15:00','16:00'],
            turbidity:    [40, 55, 120, 145, 130, 115, 127],
            conductivity: [250,310, 520, 680, 640, 600, 685]
        };
    }

    const ctx = document.getElementById('telemetryChart').getContext('2d');
    telemetryChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: history.labels,
            datasets: [
                {
                    label: 'Turbidity (NTU)',
                    data: history.turbidity,
                    borderColor: '#38BDF8',
                    backgroundColor: 'rgba(56,189,248,0.08)',
                    fill: true, tension: 0.4, borderWidth: 2,
                    pointBackgroundColor: '#38BDF8', pointBorderColor: '#060A0F',
                    pointBorderWidth: 2, pointRadius: 4, pointHoverRadius: 6
                },
                {
                    label: 'Conductivity (μS/cm)',
                    data: history.conductivity,
                    borderColor: '#EF4444',
                    backgroundColor: 'rgba(239,68,68,0.06)',
                    fill: true, tension: 0.4, borderWidth: 2, borderDash: [4,4],
                    pointBackgroundColor: '#EF4444', pointBorderColor: '#060A0F',
                    pointBorderWidth: 2, pointRadius: 4, pointHoverRadius: 6
                }
            ]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            interaction: { intersect: false, mode: 'index' },
            plugins: {
                legend: { labels: { color: '#8BA3BF', font: { family: 'JetBrains Mono', size: 11 }, padding: 16, boxWidth: 12 } },
                tooltip: { backgroundColor: 'rgba(13,21,32,0.95)', titleColor: '#F0F6FF', bodyColor: '#8BA3BF', borderColor: 'rgba(56,189,248,0.2)', borderWidth: 1, cornerRadius: 8, padding: 10 }
            },
            scales: {
                y: { grid: { color: 'rgba(56,189,248,0.06)' }, ticks: { color: '#4D6880', font: { family: 'JetBrains Mono', size: 10 } } },
                x: { grid: { display: false }, ticks: { color: '#4D6880', font: { family: 'JetBrains Mono', size: 10 } } }
            }
        }
    });
}


// ── Network Status ─────────────────────────
const ICON_MAP = {
    'Wi-Fi': 'wifi', 'GSM': 'message-square', 'LoRa': 'radio-tower', 'Radio': 'radio'
};

async function loadNetworkStatus() {
    try {
        const res   = await fetch('/api/network-status');
        const nodes = await res.json();
        renderNetwork(nodes);
    } catch(e) {
        // Demo fallback
        renderNetwork([
            { name:'Primary Dashboard (Wi-Fi)',  detail:'Real-time decision support · IP: 192.168.1.100', status:'CONNECTED',   level:'online',  icon:'wifi' },
            { name:'GSM SMS Gateway (SIM800L)',  detail:'Targeted emergency alerts · Globe Telecom',       status:'OPERATIONAL', level:'online',  icon:'message-square' },
            { name:'LoRa Mesh Network',          detail:'Field sensor comms · 868MHz · 12 active nodes',   status:'SYNCED',      level:'online',  icon:'radio-tower' },
            { name:'Radio Broadcast AM 702 kHz', detail:'Mass comms · Coverage: 50km radius',              status:'STANDBY',     level:'warning', icon:'radio' }
        ]);
    }
}

function renderNetwork(nodes) {
    document.getElementById('network-list').innerHTML = nodes.map(n => `
        <div class="net-row">
            <div class="net-icon">
                <i data-lucide="${n.icon || 'zap'}"></i>
            </div>
            <div class="net-info">
                <h4>${n.name}</h4>
                <p>${n.detail}</p>
            </div>
            <div class="net-badge ${n.level}">${n.status}</div>
        </div>
    `).join('');
    if (typeof lucide !== 'undefined') lucide.createIcons();
}


// ── Analytics Charts ───────────────────────
let analyticsInit = false;

async function initAnalyticsCharts() {
    if (analyticsInit) return;
    analyticsInit = true;

    let data = {
        risk_trend: { labels:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], high:[2,4,1,3,7,5,2], medium:[5,6,8,7,9,8,6] },
        alert_distribution: { labels:['Critical','High','Medium','Low'], data:[3,12,25,60] }
    };

    try {
        const res = await fetch('/api/analytics');
        data = await res.json();
    } catch(e) {}

    const chartOpts = {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { labels: { color:'#8BA3BF', font:{ family:'JetBrains Mono', size:11 }, padding:12, boxWidth:12 } } },
        scales: {
            y: { grid:{ color:'rgba(56,189,248,0.06)' }, ticks:{ color:'#4D6880', font:{ family:'JetBrains Mono', size:10 } } },
            x: { grid:{ display:false }, ticks:{ color:'#4D6880', font:{ family:'JetBrains Mono', size:10 } } }
        }
    };

    new Chart(document.getElementById('riskTrendChart').getContext('2d'), {
        type: 'line',
        data: {
            labels: data.risk_trend.labels,
            datasets: [
                { label:'High Risk',   data:data.risk_trend.high,   borderColor:'#EF4444', backgroundColor:'rgba(239,68,68,0.08)',   tension:0.4, fill:true, borderWidth:2 },
                { label:'Medium Risk', data:data.risk_trend.medium, borderColor:'#F97316', backgroundColor:'rgba(249,115,22,0.08)', tension:0.4, fill:true, borderWidth:2 }
            ]
        },
        options: chartOpts
    });

    new Chart(document.getElementById('alertDistributionChart').getContext('2d'), {
        type: 'doughnut',
        data: {
            labels: data.alert_distribution.labels,
            datasets: [{ data:data.alert_distribution.data, backgroundColor:['#EF4444','#F97316','#FBBF24','#22C55E'], borderWidth:0, hoverOffset:8 }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { position:'bottom', labels:{ color:'#8BA3BF', font:{ family:'JetBrains Mono', size:11 }, padding:16, boxWidth:12 } } }
        }
    });
}


// ── Boot ───────────────────────────────────
// Wait for DOM + Lucide to be ready before initialising icons
document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();
    loadRiskZones();
    initTelemetryChart().then(() => {
        fetchTelemetry();
        setInterval(fetchTelemetry, 5000);
    });
});
</script>
</body>
</html>